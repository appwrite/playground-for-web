<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Appwrite Playground</title>
    <meta name="description" content="A simple Appwrite demo app for gettig started with API integration" />
    <meta name="author" content="Appwrite Team" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,300,400,500,600,800" />
    <link rel="icon" type="image/png" href="https://appwrite.io/images/favicon.png?v=1" />

    <style>
        body {
            font-family: Poppins, sans-serif, Arial;
            -webkit-font-smoothing: antialiased;
            font-weight: 500;
        }
        #list > li:hover {
            color: #007BFF;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-dark bg-dark">
        <a class="navbar-brand" href="#"><img src="https://appwrite.io/images/appwrite-white.svg" height="22" />
            &nbsp;playground</a>
    </nav>
    <div class="jumbotron jumbotron-fluid">
        <div class="container">
            <h1 class="display-5 mb-5">Hello Appwriters!</h1>
            <p class="lead">
                Appwrite playground is a simple way to explore the Appwrite API & Web
                SDK. Use the
                <a href="https://github.com/appwrite/playground-for-js/blob/master/public/index.html"
                    target="_blank">source code</a>
                of this page to learn how to use the different Appwrite Web SDK
                features.
            </p>
        </div>
    </div>

    <div class="container">
        <h2 class="mb-5">Auth & Account</h2>

        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="isLogged()">
            Is Logged?
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="loginAnonymously()">
            Login Anonymously
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="loginWithGoogle()">
            Login With Google
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="loginWithFacebook()">
            Login With Facebook
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="loginWithGithub()">
            Login With Github
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="loginWithApple()">
            Login With Apple
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="createJWT()">
            Create JWT
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="getUserName()">
            Get User Name
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="getUserEmail()">
            Get User Email
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="getSessions()">
            Get User Sessions
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="getLogs()">
            Get User Logs
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="deleteSessions()">
            Delete All Sessions
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="deleteCurrentSession()">
            Delete Current Session
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="createTeam()">
            Create Team
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="createTeamMembership()">
            Create Team Membership
        </button>
    </div>

    <hr class="mb-5" />

    <div class="container">
        <div class="row">
            <div class="col-sm mb-5">
                <h3 class="mb-4">Register</h3>
                <form onsubmit="register(event);">
                    <div class="form-group">
                        <label for="register-email">Email</label>
                        <input type="email" class="form-control" id="register-email" placeholder="Enter email"
                            value="demo@example.com" required />
                    </div>
                    <div class="form-group">
                        <label for="register-password">Password</label>
                        <input type="password" class="form-control" id="register-password" placeholder="Password"
                            value="password" required pattern=".{6,}" title="Six or more characters" />
                    </div>
                    <button type="submit" class="btn btn-primary">Sign Up</button>
                </form>
            </div>
            <div class="col-sm mb-5">
                <h3 class="mb-4">Login</h3>
                <form onsubmit="login(event);">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" class="form-control" id="login-email" placeholder="Enter email"
                            value="demo@example.com" required />
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" class="form-control" id="login-password" placeholder="Password"
                            value="password" required pattern=".{6,}" title="Six or more characters" />
                    </div>
                    <button type="submit" class="btn btn-primary">Sign In</button>
                </form>
            </div>
        </div>
    </div>

    <hr class="mb-5" />

    <div class="container">
        <h2 class="mb-5">Storage</h2>
        <div class="row">
            <div class="col-sm mb-5">
                <h3 class="mb-4">Add File</h3>
                <div class="input-group">
                    <div class="custom-file">
                      <input type="file" class="custom-file-input" id="uploader" aria-describedby="inputGroupFileAddon04">
                      <label class="custom-file-label" id="uploader-label" for="inputGroupFile04">Choose file</label>
                    </div>
                    <div class="input-group-append">
                      <button class="btn btn-primary" type="button" id="inputGroupFileAddon04" onclick="createFile()">Upload File</button>
                    </div>
                  </div>
            </div>
            <div class="col-sm mb-5">
                <h3 class="mb-4">List Files</h3>
                <button type="button" class="btn btn-primary" onclick="listFiles()">
                    List Files
                </button>
                <div class="container mt-3">
                    <div class="row">
                        <ul id="list"></ul>
                    </div>
                </div>
            </div>
        </div>


    <hr class="mb-5" />

    <div class="container">
        <h2 class="mb-5">Realtime</h2>
        <p>Create files in the Storage service to see them listed here in realtime.</p>
        <ul id="realtime" class="list-group" />
    </div>

    <hr class="mb-5" />

    <div class="container">
        <h2 class="mb-5">Locale</h2>

        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="getLocation()">
            Get User Location
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="getIP()">
            Get User IP
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="isEU()">
            Is User a Member of the EU?
        </button>
    </div>

    <!-- Include Appwrite Web SDK before trying to create a new instance -->

    <!-- Fetch the latest sdk or use an existing one -->
    <script src="https://cdn.jsdelivr.net/npm/appwrite@10.1.0"></script>

    <script>

        document.getElementById('uploader').onchange = function () {
            document.getElementById('uploader-label').innerHTML = this.files[0].name;
        };

        // Before we start doing anything, we need to init our Appwrite Web SDK
        const client = new Appwrite.Client();

        client
            .setEndpoint("http://localhost/v1") // Set your own appwrite server endpoint here, if not sure, you can get this value from your project settings page.
            .setProject("playground"); // Your Appwrite Project UID, you can get it from your project settings page.

        // Prepare all services we are going to use
        const account = new Appwrite.Account(client);
        const storage = new Appwrite.Storage(client);
        const teams = new Appwrite.Teams(client);
        const locale = new Appwrite.Locale(client);

        /**
         * Please Note!
         *
         * Don't ever integrate your Appwrite SDK with a secret key on client apps
         * like browsers, Android apps, iOS apps and other client platforms
         * like electron, XBOX and others.
         */

        const realtimeElement = document.getElementById("realtime");

        client.subscribe("files", function(response) {
            const entry = document.createElement("li");
            const image = storage.getFilePreview('playground-bucket', response.payload.$id, 250);
            const url = storage.getFileView('playground-bucket', response.payload.$id, 250);
            entry.classList.add('list-group-item');
            entry.innerHTML = `<a href="${url}" target=_blank><b>Events</b>: ${response.events}<br><img src="${image}" /></a>`;
            realtimeElement.prepend(entry);
        });

        client.subscribe(['teams', 'memberships', 'accounts'], function(response) {
            console.log(response)
        });

        function isLogged() {
            let promise = account.get();

            promise.then(
                function (response) {
                    alert("User is Logged!");
                },
                function (error) {
                    alert("No User is Logged!");
                }
            );
        }

        function getUserName() {
            let promise = account.get();

            promise.then(
                function (response) {
                    alert(response.name);
                },
                function (error) {
                    alert("No User is Logged!");
                }
            );
        }

        function getUserEmail() {
            let promise = account.get();

            promise.then(
                function (response) {
                    alert(response.email);
                },
                function (error) {
                    alert("No User is Logged!");
                }
            );
        }

        function getSessions() {
            let promise = account.listSessions();

            promise.then(
                function (response) {
                    console.log("User Devices:", response);
                    alert(
                        "User has " +
                        response.total +
                        " active sessions. Check developer console for more info"
                    );
                },
                function (error) {
                    alert("No User is Logged!");
                }
            );
        }

        function getLogs() {
            let promise = account.listLogs();

            promise.then(
                function (response) {
                    console.log("User Logs:", response);
                    alert(
                        "User has " +
                        response.logs.length +
                        " logs. Check developer console for more info"
                    );
                },
                function (error) {
                    alert("No User is Logged!");
                }
            );
        }

        function register(event) {
            event.preventDefault();
            account
                .create(
                    "unique()",
                    event.target.elements["register-email"].value, // Email
                    event.target.elements["register-password"].value, // Password
                    "User Name"
                )
                .then(
                    function (response) {
                        alert("Account created succefully!");
                    },
                    function (error) {
                        alert("Failed to create account");
                    }
                );
        }

        function loginAnonymously() {
            account.createAnonymousSession().then(
                function (response) {
                    alert("anonymous session created successfully!");
                },
                function (error) {
                    alert("failed to create session");
                }
            );
        }

        function createJWT() {
            account.createJWT().then(
                function (response) {
                    console.log("JWT: ", response);
                    alert("JWT created.");
                },
                function (error) {
                    alert("failed to create session");
                }
            );
        }

        function login(event) {
            event.preventDefault();
            account
                .createEmailSession(
                    event.target.elements["login-email"].value, // Email
                    event.target.elements["login-password"].value // Password
                )
                .then(
                    function (response) {
                        alert("Session created succefully!");
                        client.subscribe("account", function(response) {
                            console.log('Received Account event', response);
                        });

                    },
                    function (error) {
                        alert("Failed to create session");
                    }
                );
        }

        function loginWithGoogle(event) {
            /**
             * Callback URLs are required for creating a browser
             *  session cookie due to some browsers 3rd party cookie policy limitations,
             *  this is not required for other client based platforms
             */
            let promise = account.createOAuth2Session(
                "google",
                "http://localhost:8000/?success", // Callback URL for success
                "http://localhost:8000/?failure" // Callback URL for failure
            );

            promise.then(
                function (response) {
                    console.log(response); // Success
                },
                function (error) {
                    console.log(error); // Failure
                }
            );
        }

        function loginWithFacebook(event) {
            /**
             * Callback URLs are required for creating a browser
             *  session cookie due to some browsers 3rd party cookie policy limitations,
             *  this is not required for other client based platforms
             */
            let promise = account.createOAuth2Session(
                "facebook",
                "http://localhost:8000/?success", // Callback URL for success
                "http://localhost:8000/?failure", // Callback URL for failure
                ["user_location"]
            );

            promise.then(
                function (response) {
                    console.log(response); // Success
                },
                function (error) {
                    console.log(error); // Failure
                }
            );
        }

        function loginWithGithub(event) {
            /**
             * Callback URLs are required for creating a browser
             *  session cookie due to some browsers 3rd party cookie policy limitations,
             *  this is not required for other client based platforms
             */
            let promise = account.createOAuth2Session(
                "github",
                "http://localhost:8000/?success", // Callback URL for success
                "http://localhost:8000/?failure", // Callback URL for failure
                []
            );

            promise.then(
                function (response) {
                    console.log(response); // Success
                },
                function (error) {
                    console.log(error); // Failure
                }
            );
        }

        function loginWithApple(event) {
            /**
             * Callback URLs are required for creating a browser
             *  session cookie due to some browsers 3rd party cookie policy limitations,
             *  this is not required for other client based platforms
             */
            let promise = account.createOAuth2Session(
                "apple",
                "http://localhost:8000/?success", // Callback URL for success
                "http://localhost:8000/?failure" // Callback URL for failure
            );

            promise.then(
                function (response) {
                    console.log(response); // Success
                },
                function (error) {
                    console.log(error); // Failure
                }
            );
        }

        function deleteSessions() {
            let promise = account.deleteSessions();

            promise.then(
                function (response) {
                    console.log("All session deleted."); // Success
                },
                function (error) {
                    console.log(error); // Failure
                }
            );
        }

        function deleteCurrentSession() {
            let promise = account.deleteSession('current');

            promise.then(
                function (response) {
                    console.log("Current session deleted."); // Success
                },
                function (error) {
                    console.log(error); // Failure
                }
            );
        }

        function createTeam() {
            let promise = teams.create('test', 'Test Team');

            promise.then(
                function (response) {
                    alert("Team created."); // Success
                },
                function (error) {
                    alert(error); // Failure
                }
            );
        }

        function createTeamMembership() {
            let random = Math.floor(1000 + Math.random() * 9000);
            let email = "test+" + random + "@test.com";
            let promise = teams.createMembership('test', email, ['admin'], 'http://localhost');

            promise.then(
                function (response) {
                    alert("Membership created."); // Success
                },
                function (error) {
                    alert(error); // Failure
                }
            );
        }

        function createFile() {
            let promise = storage.createFile('playground-bucket', 'unique()', document.getElementById('uploader').files[0]);

            promise.then(function (response) {
                console.log(response); // Success
                alert("File uploaded successfully");
            }, function (error) {
                console.log(error); // Failure
                alert("File failed to upload");
            });
        }

        function listFiles() {
            let promise = storage.listFiles('playground-bucket');

            promise.then(function (response) {
                var ul = document.getElementById("list");
                ul.innerHTML = '';
                for(let i=1; i<=response.total; i++){
                    var li = document.createElement("li");
                    li.innerHTML = response.files[i-1].name;
                    console.log(response.files[i-1].$id);
                    li.onclick = function () { 
                        getFile(response.files[i-1].$id);
                    };
                    ul.appendChild(li);
                }
                console.log(response); // Success
            }, function (error) {
                console.log(error); // Failure
            });
        }

        function getFile(file_id) {
            let promise = storage.getFile('playground-bucket', file_id);

            promise.then(function (response) {
                alert(JSON.stringify(response, undefined, 2));
                console.log(response); // Success
            }, function (error) {
                console.log(error); // Failure
            });
        }

        function getLocation() {
            let promise = locale.get();

            promise.then(
                function (response) {
                    alert(
                        "User is from " +
                        response.country +
                        ", country code is: " +
                        response.countryCode
                    );
                },
                function (error) {
                    alert("No User is Logged!");
                }
            );
        }

        function getIP() {
            let promise = locale.get();

            promise.then(
                function (response) {
                    alert("User IP is: " + response.ip);
                },
                function (error) {
                    alert("Failed to get user locale.");
                }
            );
        }

        function isEU() {
            let promise = locale.get();

            promise.then(
                function (response) {
                    alert(
                        response.eu
                            ? "User is a member of the EU"
                            : "User is not a member of the EU"
                    );
                },
                function (error) {
                    alert("Failed to get user locale.");
                }
            );
        }

      // let promise = appwrite.database.createDocument('5dac4fc8d9f0c', {
      //     'completed': true,
      //     'text': 'a new task',
      // }, ['*'], ['*']);

      // let promise = appwrite.database.createDocument('5dac4fc8d9f0c', {
      //     'completed': true,
      //     'text': 'a new task',
      // });

      // let promise = appwrite.database.createDocument('5dac4fc8d9f0c', {
      //     'completed': true,
      //     'text': 'a new task',
      // }, ['user:{self}'], ['user:{self}']);

      // console.log('[INFO] Adding Todo');
      // promise.then(function(response) {
      //     console.log(response);
      // }, function(error) {
      //     console.log(error);
      // });
    </script>
</body>

</html>
